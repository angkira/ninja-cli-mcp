# 2026-02-08: Model Configuration & File Detection Fix

## Issue 1: Model Configuration
Simple tasks failing in 0.6s with no output - model `openrouter/qwen/qwen3-coder-next` doesn't exist in OpenCode.

### Root Cause
OpenCode threw `ProviderModelNotFoundError` because `qwen3-coder-next` is not a valid model name.
Correct model: `openrouter/qwen/qwen3-coder`

### Fix
Updated `~/.ninja-mcp.env`:
- `NINJA_MODEL_QUICK`: `openrouter/qwen/qwen3-coder-next` → `openrouter/qwen/qwen3-coder`
- `NINJA_CODER_MODEL`: `openrouter/qwen/qwen3-coder-next` → `openrouter/qwen/qwen3-coder`

## Issue 2: File Detection False Negatives
Tasks reporting "⚠️ Task completed but no files were modified" even when files ARE created.

### Root Cause
**Regex Pattern Bug**: OpenCode uses `←` (leftwards arrow, U+2190) for tool calls, but regex was looking for `|` (pipe):
- OpenCode format: `← Write filename.py`
- Old pattern: `r"\|\s+(?:Edit|Write)..."`  ❌
- **Fixed pattern**: `r"[←\|]\s+(?:Edit|Write)..."`  ✅

### Fix
Updated `src/ninja_coder/strategies/opencode_strategy.py`:
1. Fixed regex to match both `←` and `|` (line 346)
2. Added git-based detection for untracked files (lines 382-415)
   - `git diff --name-only HEAD` - modified tracked files
   - `git ls-files --others --exclude-standard` - new untracked files
3. Added debug logging for troubleshooting

Restarted daemon: `ninja-daemon restart coder`

## Validation
- Simple task: 22.2s, file created ✅
- Sequential: Both steps working ✅
- Parallel: Both tasks working ✅
- Process cleanup: No orphans ✅
- **File detection: Regex now correctly matches OpenCode output** ✅

## Notes
- OpenRouter has rate limits - occasional failures expected
- File detection now works for both new and modified files
- Git-based detection serves as backup when regex fails
